<div #tableContainer class="persons-table-container">
  <table mat-table [dataSource]="persons" class="mat-compact-table mat-mdc-table" matSort matSortDisableClear (matSortChange)="onSortChange($event)">

    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="1" class="centered"> ID </th>
      <td mat-cell *matCellDef="let person" class="centered"> {{ person.id }} </td>
    </ng-container>

    <ng-container matColumnDef="firstname">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="2"> First name </th>
      <td mat-cell *matCellDef="let person"> {{ person.firstname }} </td>
    </ng-container>

    <ng-container matColumnDef="lastname">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="3"> Last name </th>
      <td mat-cell *matCellDef="let person"> {{ person.lastname }} </td>
    </ng-container>

    <ng-container matColumnDef="birthdate">
      <th mat-header-cell *matHeaderCellDef  mat-sort-header="4" class="centered"> Birth date </th>
      <td mat-cell *matCellDef="let person" class="centered"> {{ person.birthdate | date }} </td>
    </ng-container>

    <ng-container matColumnDef="email">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="5"> Email </th>
      <td mat-cell *matCellDef="let person"> {{ person.email }} </td>
    </ng-container>

    <ng-container matColumnDef="teams">
      <th mat-header-cell *matHeaderCellDef> Teams </th>
      <td mat-cell *matCellDef="let person">
        @if(person?.team_objects?.length === 0) {
          <span class="no-teams">no teams</span>
        } @else {
          <div class="team">
            @for(team of person?.team_objects; track team.id) {
              @if(team.has_avatar) {
                <img
                  alt="avatar"
                  [src]="'/uploads/avatar/' + team.id + '.png?' + timestamp"
                  class="avatar-image" 
                />
              } @else {
                <mat-chip [style.background-color]="team.color" [ngStyle]="{
                  '--mat-chip-label-text-color': getContrastColor(team.color),
                  'background-color': team.color
                }"> {{ team.name }} </mat-chip>
              }
            }
          </div>
        }    
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"
      (click)="openDialog(row)"
      class="clickable-row"
      [attr.id]="'person-' + row.id">
    </tr>
  </table>

  <div #loadMore class="sentinel"></div>

  @if (loading) { 
    <div class="loading-wrapper">
      <mat-spinner [diameter]="24"></mat-spinner>
      <span>Loading more...</span>
    </div>
  }
</div>